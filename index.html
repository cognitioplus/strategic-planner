<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Strategic Planner</title>
<link rel="manifest" id="manifest-placeholder">
<meta name="theme-color" content="#1e293b">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<script src="https://cdn.tailwindcss.com"></script>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>
::-webkit-scrollbar { width: 8px; height: 8px; }
::-webkit-scrollbar-track { background: #f1f5f9; }
::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
@media print {
body * { visibility: hidden; }
.printable-content, .printable-content * { visibility: visible; }
.printable-content { position: absolute; left: 0; top: 0; width: 100%; box-shadow: none; border: none; }
.no-print { display: none !important; }
}
.input-field {
@apply w-full px-4 py-2 bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all text-sm;
}
.btn-primary {
@apply flex items-center justify-center px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all font-semibold shadow-sm disabled:opacity-50;
}
.ai-badge {
@apply bg-gradient-to-r from-indigo-500 to-purple-600 text-white text-[10px] px-2 py-0.5 rounded-full font-bold tracking-wider uppercase flex items-center gap-1;
}
.shimmer {
background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
background-size: 200% 100%;
animation: shimmer 1.5s infinite;
}
@keyframes shimmer {
0% { background-position: 200% 0; }
100% { background-position: -200% 0; }
}
</style>
</head>
<body class="bg-slate-100 text-slate-800">
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useMemo, useRef } = React;

// --- ICONS ---
const Icon = ({ path, size = 20, className = "" }) => (
<svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
{path}
</svg>
);
const Icons = {
LayoutDashboard: (props) => <Icon {...props} path={<><rect width="7" height="9" x="3" y="3" rx="1" /><rect width="7" height="5" x="14" y="3" rx="1" /><rect width="7" height="9" x="14" y="12" rx="1" /><rect width="7" height="5" x="3" y="16" rx="1" /></>} />,
ClipboardList: (props) => <Icon {...props} path={<><rect width="8" height="4" x="8" y="2" rx="1" ry="1" /><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" /><path d="M12 11h4" /><path d="M12 16h4" /><path d="M8 11h.01" /><path d="M8 16h.01" /></>} />,
Users: (props) => <Icon {...props} path={<><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M22 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></>} />,
Target: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10" /><circle cx="12" cy="12" r="6" /><circle cx="12" cy="12" r="2" /></>} />,
PieChart: (props) => <Icon {...props} path={<><path d="M21.21 15.89A10 10 0 1 1 8 2.83" /><path d="M22 12A10 10 0 0 0 12 2v10z" /></>} />,
FileText: (props) => <Icon {...props} path={<><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z" /><path d="M14 2v4a2 2 0 0 0 2 2h4" /><path d="M10 9H8" /><path d="M16 13H8" /><path d="M16 17H8" /></>} />,
Plus: (props) => <Icon {...props} path={<><path d="M5 12h14" /><path d="M12 5v14" /></>} />,
Trash2: (props) => <Icon {...props} path={<><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /><line x1="10" x2="10" y1="11" y2="17" /><line x1="14" x2="14" y1="11" y2="17" /></>} />,
Pencil: (props) => <Icon {...props} path={<><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" /><path d="m15 5 4 4" /></>} />,
Menu: (props) => <Icon {...props} path={<><line x1="4" x2="20" y1="12" y2="12" /><line x1="4" x2="20" y1="6" y2="6" /><line x1="4" x2="20" y1="18" y2="18" /></>} />,
X: (props) => <Icon {...props} path={<><path d="M18 6 6 18" /><path d="m6 6 12 12" /></>} />,
Sparkles: (props) => <Icon {...props} path={<><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" /><path d="M5 3v4" /><path d="M3 5h4" /><path d="M21 17v4" /><path d="M19 19h4" /></>} />,
Check: (props) => <Icon {...props} path={<><polyline points="20 6 9 17 4 12" /></>} />,
DollarSign: (props) => <Icon {...props} path={<><line x1="12" x2="12" y1="2" y2="22" /><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" /></>} />,
Settings: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="3" /><path d="M12 2v2" /><path d="M12 20v2" /><path d="M4.93 4.93l1.41 1.41" /><path d="M17.66 17.66l1.41 1.41" /><path d="M2 12h2" /><path d="M20 12h2" /><path d="M6.34 17.66l1.41-1.41" /><path d="M19.07 4.93l1.41-1.41" /></>} />
};

// --- DATA SERVICE ---
const DataService = {
  get: (key) => JSON.parse(localStorage.getItem(key)) || [],
  set: (key, data) => localStorage.setItem(key, JSON.stringify(data)),
  add: (collection, item) => {
    const newItem = { ...item, id: Date.now().toString() };
    const updated = [newItem, ...DataService.get(collection)];
    DataService.set(collection, updated);
    return updated;
  },
  update: (collection, id, updates) => {
    const updated = DataService.get(collection).map(item => item.id === id ? { ...item, ...updates } : item);
    DataService.set(collection, updated);
    return updated;
  },
  delete: (collection, id) => {
    const updated = DataService.get(collection).filter(item => item.id !== id);
    DataService.set(collection, updated);
    return updated;
  }
};

// --- AI SERVICE (OpenAI) ---
const AIService = {
  async generate(userPrompt, systemPrompt, schema, apiKey) {
    if (!apiKey) throw new Error("API key required");
    const maxRetries = 3;
    for (let retries = 0; retries < maxRetries; retries++) {
      try {
        const jsonInstruction = `Respond ONLY with valid JSON matching: ${JSON.stringify(schema)}.`;
        const res = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
          body: JSON.stringify({
            model: "gpt-4o-mini",
            messages: [
              { role: "system", content: systemPrompt },
              { role: "user", content: userPrompt + "\n\n" + jsonInstruction }
            ],
            temperature: 0.4,
            response_format: { type: "json_object" }
          })
        });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        return JSON.parse(data.choices[0].message.content);
      } catch (e) {
        if (retries === maxRetries - 1) throw e;
        await new Promise(r => setTimeout(r, 1000 * Math.pow(2, retries)));
      }
    }
  }
};

// --- MAIN APP ---
function App() {
  const [activeTab, setActiveTab] = useState('dashboard');
  const [isSidebarOpen, setIsSidebarOpen] = useState(false);
  const [apiKey, setApiKey] = useState(localStorage.getItem('openaiApiKey') || '');
  const [loading, setLoading] = useState(true);

  // Data states
  const [objectives, setObjectives] = useState([]);
  const [swot, setSwot] = useState([]);
  const [strategies, setStrategies] = useState(null);
  const [bsc, setBsc] = useState([]);
  const [initiatives, setInitiatives] = useState([]);
  const [team, setTeam] = useState([]);

  useEffect(() => {
    setObjectives(DataService.get('objectives'));
    setSwot(DataService.get('swot'));
    setBsc(DataService.get('bsc'));
    setInitiatives(DataService.get('initiatives'));
    setTeam(DataService.get('team'));
    setLoading(false);
  }, []);

  const saveApiKey = (key) => {
    setApiKey(key);
    localStorage.setItem('openaiApiKey', key);
  };

  const handleNav = (tab) => {
    setActiveTab(tab);
    setIsSidebarOpen(false);
    window.scrollTo(0,0);
  };

  if (loading) return <div className="flex items-center justify-center h-screen">Loading...</div>;

  return (
    <div className="flex h-screen bg-slate-100 overflow-hidden font-sans">
      <aside className={`fixed inset-y-0 left-0 z-50 w-64 bg-slate-900 text-white transform transition-transform duration-300 ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'} md:relative md:translate-x-0`}>
        <div className="p-6 border-b border-slate-700 flex justify-between items-center">
          <div>
            <h1 className="text-xl font-bold text-blue-400">Strategic Planner</h1>
            <p className="text-xs text-slate-400">Universal Edition</p>
          </div>
          <button onClick={() => setIsSidebarOpen(false)} className="md:hidden text-slate-400"><Icons.X /></button>
        </div>
        <nav className="p-4 space-y-2">
          <NavButton active={activeTab === 'dashboard'} onClick={() => handleNav('dashboard')} icon={<Icons.LayoutDashboard />}>Dashboard</NavButton>
          <NavButton active={activeTab === 'objectives'} onClick={() => handleNav('objectives')} icon={<Icons.Target />}>Objectives & SWOT</NavButton>
          <NavButton active={activeTab === 'bsc'} onClick={() => handleNav('bsc')} icon={<Icons.PieChart />}>Balanced Scorecard</NavButton>
          <NavButton active={activeTab === 'initiatives'} onClick={() => handleNav('initiatives')} icon={<Icons.ClipboardList />}>Initiatives</NavButton>
          <NavButton active={activeTab === 'team'} onClick={() => handleNav('team')} icon={<Icons.Users />}>Team</NavButton>
          <NavButton active={activeTab === 'report'} onClick={() => handleNav('report')} icon={<Icons.FileText />}>Strategic Plan</NavButton>
          <NavButton active={activeTab === 'settings'} onClick={() => handleNav('settings')} icon={<Icons.Settings />}>AI Settings</NavButton>
        </nav>
      </aside>

      <main className="flex-1 overflow-auto">
        <header className="md:hidden bg-white p-4 shadow-sm flex items-center justify-between sticky top-0 z-20">
          <h2 className="font-semibold text-sm">Strategic Planner</h2>
          <button onClick={() => setIsSidebarOpen(true)}><Icons.Menu /></button>
        </header>

        <div className="p-6 md:p-10 max-w-7xl mx-auto pb-20">
          {activeTab === 'dashboard' && <DashboardView objectives={objectives} swot={swot} bsc={bsc} initiatives={initiatives} team={team} />}
          {activeTab === 'objectives' && <ObjectivesView swot={swot} setSwot={setSwot} apiKey={apiKey} strategies={strategies} setStrategies={setStrategies} />}
          {activeTab === 'bsc' && <BscView bsc={bsc} setBsc={setBsc} apiKey={apiKey} />}
          {activeTab === 'initiatives' && <InitiativesView initiatives={initiatives} setInitiatives={setInitiatives} />}
          {activeTab === 'team' && <TeamView team={team} setTeam={setTeam} />}
          {activeTab === 'report' && <ReportView objectives={objectives} swot={swot} strategies={strategies} bsc={bsc} initiatives={initiatives} team={team} />}
          {activeTab === 'settings' && <SettingsView apiKey={apiKey} saveApiKey={saveApiKey} />}
        </div>
      </main>
    </div>
  );
}

// --- REUSABLE COMPONENTS ---
const NavButton = ({ active, onClick, icon, children }) => (
  <button onClick={onClick} className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all ${active ? 'bg-blue-600 text-white shadow-md' : 'text-slate-300 hover:bg-slate-800'}`}>
    {icon}<span className="font-medium">{children}</span>
  </button>
);

const StatCard = ({ title, value, icon }) => (
  <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200 flex justify-between items-center">
    <div><p className="text-xs font-bold text-slate-400 uppercase tracking-wider">{title}</p><h3 className="text-2xl font-black mt-1">{value}</h3></div>
    <div className="p-3 bg-slate-50 rounded-xl">{icon}</div>
  </div>
);

// --- VIEWS ---
const DashboardView = ({ objectives, swot, bsc, initiatives, team }) => (
  <div className="space-y-6">
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
      <StatCard title="Strategic Objectives" value={objectives.length} icon={<Icons.Target className="text-purple-500" />} />
      <StatCard title="SWOT Items" value={swot.length} icon={<Icons.Target className="text-emerald-500" />} />
      <StatCard title="BSC Objectives" value={bsc.length} icon={<Icons.PieChart className="text-orange-500" />} />
      <StatCard title="Initiatives" value={initiatives.length} icon={<Icons.ClipboardList className="text-blue-500" />} />
      <StatCard title="Team Members" value={team.length} icon={<Icons.Users className="text-indigo-500" />} />
    </div>
  </div>
);

const ObjectivesView = ({ swot, setSwot, apiKey, strategies, setStrategies }) => {
  const [form, setForm] = useState({ type: 'Strength', text: '' });
  const [editingId, setEditingId] = useState(null);
  const [generating, setGenerating] = useState(false);

  const handleSubmit = (e) => {
    e.preventDefault();
    if (editingId) {
      DataService.update('swot', editingId, form);
      setSwot(DataService.get('swot'));
    } else {
      DataService.add('swot', form);
      setSwot(DataService.get('swot'));
    }
    setForm({ type: 'Strength', text: '' });
    setEditingId(null);
  };

  const editItem = (item) => {
    setForm(item);
    setEditingId(item.id);
  };

  const deleteItem = (id) => {
    DataService.delete('swot', id);
    setSwot(DataService.get('swot'));
  };

  const generateStrategies = async () => {
    if (!apiKey) return alert("Please set your OpenAI API key in AI Settings.");
    if (swot.length < 2) return alert("Add at least 2 SWOT items.");
    setGenerating(true);
    try {
      const prompt = `Strengths: ${swot.filter(s => s.type === 'Strength').map(s => s.text).join('; ')}
Weaknesses: ${swot.filter(s => s.type === 'Weakness').map(s => s.text).join('; ')}
Opportunities: ${swot.filter(s => s.type === 'Opportunity').map(s => s.text).join('; ')}
Threats: ${swot.filter(s => s.type === 'Threat').map(s => s.text).join('; ')}`;
      const system = "You are a strategic planning expert. Output JSON with keys: so, st, wo, wt.";
      const schema = { type: "OBJECT", properties: { so: { type: "STRING" }, st: { type: "STRING" }, wo: { type: "STRING" }, wt: { type: "STRING" } } };
      const result = await AIService.generate(prompt, system, schema, apiKey);
      setStrategies(result);
    } catch (e) {
      alert("AI Error: " + e.message);
    } finally {
      setGenerating(false);
    }
  };

  return (
    <div className="space-y-6">
      <div className="bg-white p-6 rounded-xl shadow-md border border-slate-200">
        <h3 className="font-bold mb-4">{editingId ? 'Edit SWOT Item' : 'Add SWOT Item'}</h3>
        <form onSubmit={handleSubmit} className="flex gap-4">
          <select className="input-field w-40" value={form.type} onChange={e => setForm({...form, type: e.target.value})}>
            {['Strength', 'Weakness', 'Opportunity', 'Threat'].map(t => <option key={t} value={t}>{t}</option>)}
          </select>
          <input className="input-field flex-1" placeholder="Enter detail..." value={form.text} onChange={e => setForm({...form, text: e.target.value})} required />
          <button type="submit" className="btn-primary whitespace-nowrap">{editingId ? 'Update' : 'Add'}</button>
        </form>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        {['Strength', 'Weakness', 'Opportunity', 'Threat'].map(type => (
          <div key={type} className="bg-white rounded-xl border border-slate-200 overflow-hidden">
            <h4 className={`p-4 font-black uppercase text-xs border-b tracking-widest ${
              type === 'Strength' ? 'bg-emerald-50 text-emerald-700' :
              type === 'Weakness' ? 'bg-orange-50 text-orange-700' :
              type === 'Opportunity' ? 'bg-blue-50 text-blue-700' : 'bg-red-50 text-red-700'
            }`}>{type === 'Opportunity' ? 'Opportunities' : `${type}s`}</h4>
            <ul className="p-4 space-y-2 max-h-[300px] overflow-auto">
              {swot.filter(s => s.type === type).map(s => (
                <li key={s.id} className="p-3 bg-slate-50 border rounded-lg text-sm flex justify-between group">
                  <span>{s.text}</span>
                  <div className="flex space-x-1 opacity-0 group-hover:opacity-100">
                    <button onClick={() => editItem(s)} className="text-blue-500"><Icons.Pencil size={14}/></button>
                    <button onClick={() => deleteItem(s.id)} className="text-red-500"><Icons.Trash2 size={14}/></button>
                  </div>
                </li>
              ))}
            </ul>
          </div>
        ))}
      </div>

      <div className="pt-6 border-t">
        <div className="flex justify-between items-center mb-4">
          <h3 className="font-black flex items-center gap-2">
            Strategic Options <span className="ai-badge"><Icons.Sparkles size={10}/> AI</span>
          </h3>
          <button onClick={generateStrategies} disabled={generating} className="btn-primary flex items-center gap-1">
            {generating ? 'Generating...' : <><Icons.Sparkles size={14}/> Generate</>}
          </button>
        </div>
        {strategies ? (
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <StrategyCard label="SO Strategy" desc={strategies.so} color="emerald" />
            <StrategyCard label="ST Strategy" desc={strategies.st} color="red" />
            <StrategyCard label="WO Strategy" desc={strategies.wo} color="blue" />
            <StrategyCard label="WT Strategy" desc={strategies.wt} color="slate" />
          </div>
        ) : (
          <div className="p-10 bg-slate-50 border-dashed rounded-xl text-center text-slate-400">
            Add SWOT items then click "Generate" to create AI-powered strategies.
          </div>
        )}
      </div>
    </div>
  );
};

const StrategyCard = ({ label, desc, color }) => (
  <div className={`p-5 rounded-xl border bg-white border-l-4 border-l-${color}-500 shadow-sm`}>
    <h5 className="font-bold text-xs uppercase text-slate-400 mb-2">{label}</h5>
    <p className="text-sm italic">"{desc}"</p>
  </div>
);

const BscView = ({ bsc, setBsc, apiKey }) => {
  const [form, setForm] = useState({ strategy: '', perspective: 'Stakeholder', kpi: '' });
  const [editingId, setEditingId] = useState(null);

  const suggestKPI = async () => {
    if (!form.strategy || !apiKey) return;
    const prompt = `Suggest one measurable KPI for: "${form.strategy}" in the ${form.perspective} perspective.`;
    try {
      const res = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
        body: JSON.stringify({
          model: "gpt-4o-mini",
          messages: [{ role: "user", content: prompt }],
          max_tokens: 50
        })
      });
      const data = await res.json();
      setForm({...form, kpi: data.choices[0].message.content.trim()});
    } catch (e) { /* ignore */ }
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    if (editingId) {
      DataService.update('bsc', editingId, form);
      setBsc(DataService.get('bsc'));
    } else {
      DataService.add('bsc', form);
      setBsc(DataService.get('bsc'));
    }
    setForm({ strategy: '', perspective: 'Stakeholder', kpi: '' });
    setEditingId(null);
  };

  const editItem = (item) => {
    setForm(item);
    setEditingId(item.id);
  };

  const deleteItem = (id) => {
    DataService.delete('bsc', id);
    setBsc(DataService.get('bsc'));
  };

  return (
    <div className="space-y-6">
      <div className="bg-white p-6 rounded-xl shadow-md border border-slate-200">
        <h3 className="font-black mb-4">{editingId ? 'Update Objective' : 'Add BSC Objective'}</h3>
        <form onSubmit={handleSubmit} className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <input className="input-field" placeholder="Strategic Objective" value={form.strategy} onChange={e => setForm({...form, strategy: e.target.value})} onBlur={suggestKPI} required />
          <select className="input-field" value={form.perspective} onChange={e => setForm({...form, perspective: e.target.value})}>
            {['Stakeholder', 'Internal Process', 'Learning & Growth', 'Financial'].map(p => <option key={p} value={p}>{p}</option>)}
          </select>
          <input className="input-field" placeholder="KPI / Measure" value={form.kpi} onChange={e => setForm({...form, kpi: e.target.value})} required />
          <div className="md:col-span-3 flex justify-end gap-2">
            <button type="submit" className="btn-primary">{editingId ? 'Update' : 'Add'}</button>
          </div>
        </form>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {['Stakeholder', 'Internal Process', 'Learning & Growth', 'Financial'].map(p => (
          <div key={p} className="bg-white rounded-xl border border-slate-200 overflow-hidden">
            <h4 className="px-4 py-3 bg-slate-50 font-black text-xs text-slate-600 border-b flex justify-between">
              {p} Perspective
              <span className="bg-blue-600 text-white w-5 h-5 rounded-full flex items-center justify-center text-[10px]">{bsc.filter(b => b.perspective === p).length}</span>
            </h4>
            <div className="p-4 space-y-3 min-h-[100px]">
              {bsc.filter(b => b.perspective === p).map(b => (
                <div key={b.id} className="p-3 bg-white border rounded-lg group relative">
                  <div className="font-bold text-sm">{b.strategy}</div>
                  <div className="text-[10px] text-blue-500 font-bold mt-2 border-t pt-2 uppercase">KPI: {b.kpi}</div>
                  <div className="absolute top-2 right-2 flex space-x-1 opacity-0 group-hover:opacity-100">
                    <button onClick={() => editItem(b)} className="text-slate-400"><Icons.Pencil size={12}/></button>
                    <button onClick={() => deleteItem(b.id)} className="text-slate-400"><Icons.Trash2 size={12}/></button>
                  </div>
                </div>
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

const InitiativesView = ({ initiatives, setInitiatives }) => {
  const [form, setForm] = useState({ title: '', unit: '', responsible: '', kpi: '', target: '', timeline: '' });
  const [editingId, setEditingId] = useState(null);

  const handleSubmit = (e) => {
    e.preventDefault();
    if (editingId) {
      DataService.update('initiatives', editingId, form);
      setInitiatives(DataService.get('initiatives'));
    } else {
      DataService.add('initiatives', form);
      setInitiatives(DataService.get('initiatives'));
    }
    setForm({ title: '', unit: '', responsible: '', kpi: '', target: '', timeline: '' });
    setEditingId(null);
  };

  const editItem = (item) => {
    setForm(item);
    setEditingId(item.id);
  };

  const deleteItem = (id) => {
    DataService.delete('initiatives', id);
    setInitiatives(DataService.get('initiatives'));
  };

  return (
    <div className="space-y-6">
      <div className="bg-white p-6 rounded-xl shadow-md border border-slate-200">
        <h3 className="font-bold mb-4">{editingId ? 'Edit Initiative' : 'Add Initiative'}</h3>
        <form onSubmit={handleSubmit} className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <input className="input-field" placeholder="Title" value={form.title} onChange={e => setForm({...form, title: e.target.value})} required />
          <input className="input-field" placeholder="Unit" value={form.unit} onChange={e => setForm({...form, unit: e.target.value})} required />
          <input className="input-field" placeholder="Responsible Person" value={form.responsible} onChange={e => setForm({...form, responsible: e.target.value})} required />
          <input className="input-field" placeholder="KPI" value={form.kpi} onChange={e => setForm({...form, kpi: e.target.value})} required />
          <input className="input-field" placeholder="Target" value={form.target} onChange={e => setForm({...form, target: e.target.value})} required />
          <input className="input-field" placeholder="Timeline" value={form.timeline} onChange={e => setForm({...form, timeline: e.target.value})} required />
          <div className="md:col-span-3 flex justify-end gap-2">
            <button type="submit" className="btn-primary">{editingId ? 'Update' : 'Add'}</button>
          </div>
        </form>
      </div>

      <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-x-auto">
        <table className="w-full text-sm">
          <thead className="bg-slate-50 border-b text-slate-500 font-bold">
            <tr>
              <th className="p-4">INITIATIVE</th>
              <th className="p-4">UNIT / PERSON</th>
              <th className="p-4">KPI / TARGET</th>
              <th className="p-4">TIMELINE</th>
              <th className="p-4 text-right">ACTIONS</th>
            </tr>
          </thead>
          <tbody className="divide-y divide-slate-100">
            {initiatives.map(i => (
              <tr key={i.id} className="hover:bg-blue-50/30">
                <td className="p-4">{i.title}</td>
                <td className="p-4">{i.unit} / {i.responsible}</td>
                <td className="p-4">{i.kpi}: <span className="font-bold">{i.target}</span></td>
                <td className="p-4">{i.timeline}</td>
                <td className="p-4 text-right space-x-3">
                  <button onClick={() => editItem(i)} className="text-slate-400"><Icons.Pencil size={18}/></button>
                  <button onClick={() => deleteItem(i.id)} className="text-slate-400"><Icons.Trash2 size={18}/></button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
};

const TeamView = ({ team, setTeam }) => {
  const [form, setForm] = useState({ name: '', role: '' });
  const [editingId, setEditingId] = useState(null);

  const handleSubmit = (e) => {
    e.preventDefault();
    if (editingId) {
      DataService.update('team', editingId, form);
      setTeam(DataService.get('team'));
    } else {
      DataService.add('team', form);
      setTeam(DataService.get('team'));
    }
    setForm({ name: '', role: '' });
    setEditingId(null);
  };

  const editItem = (item) => {
    setForm(item);
    setEditingId(item.id);
  };

  const deleteItem = (id) => {
    DataService.delete('team', id);
    setTeam(DataService.get('team'));
  };

  return (
    <div className="space-y-6">
      <div className="bg-white p-6 rounded-xl shadow-md border border-slate-200">
        <h3 className="font-bold mb-4">{editingId ? 'Update Member' : 'Add Team Member'}</h3>
        <form onSubmit={handleSubmit} className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <input className="input-field" placeholder="Full Name" value={form.name} onChange={e => setForm({...form, name: e.target.value})} required />
          <input className="input-field" placeholder="Role" value={form.role} onChange={e => setForm({...form, role: e.target.value})} required />
          <div className="md:col-span-2 flex justify-end gap-2">
            <button type="submit" className="btn-primary">{editingId ? 'Update' : 'Add'}</button>
          </div>
        </form>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {team.map(m => (
          <div key={m.id} className="bg-white p-5 rounded-xl border shadow-sm group relative">
            <div className="font-black text-slate-800 text-lg">{m.name}</div>
            <div className="text-[10px] text-blue-600 font-bold uppercase mt-1">{m.role}</div>
            <div className="absolute top-4 right-4 flex space-x-2 opacity-0 group-hover:opacity-100">
              <button onClick={() => editItem(m)} className="text-slate-400"><Icons.Pencil size={16}/></button>
              <button onClick={() => deleteItem(m.id)} className="text-slate-400"><Icons.Trash2 size={16}/></button>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

const ReportView = ({ swot, strategies, bsc, initiatives, team }) => (
  <div className="bg-white p-10 shadow-2xl printable-content mx-auto max-w-5xl border rounded-xl">
    <div className="flex justify-between items-start border-b-2 pb-8 mb-8">
      <div>
        <h1 className="text-3xl font-black uppercase">Strategic Plan</h1>
        <p className="text-blue-600 font-bold tracking-[0.2em] mt-1 uppercase">Operational Roadmap</p>
      </div>
      <div className="text-right">
        <span className="bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full text-xs font-black uppercase">Official Draft</span>
      </div>
    </div>

    <section className="mb-12">
      <h2 className="text-xl font-black flex items-center gap-2 mb-4"><Icons.Target size={18} /> SWOT Analysis</h2>
      <div className="grid grid-cols-2 gap-4">
        {['Strength', 'Weakness', 'Opportunity', 'Threat'].map(t => (
          <div key={t} className="p-4 border bg-white rounded-lg">
            <h3 className="font-black text-xs mb-2 border-b pb-1 inline-block">{t === 'Opportunity' ? 'Opportunities' : `${t}s`}</h3>
            {swot.filter(s => s.type === t).map(s => <div key={s.id} className="text-[11px] mb-1">• {s.text}</div>)}
          </div>
        ))}
      </div>
    </section>

    {strategies && (
      <section className="mb-12">
        <h2 className="text-xl font-black flex items-center gap-2 mb-4"><Icons.Sparkles size={18} /> Strategic Recommendations</h2>
        {Object.entries(strategies).map(([key, desc]) => (
          <div key={key} className="p-3 bg-slate-50 rounded mb-2 text-sm italic">• {desc}</div>
        ))}
      </section>
    )}

    <section className="mb-12">
      <h2 className="text-xl font-black flex items-center gap-2 mb-4"><Icons.PieChart size={18} /> Balanced Scorecard</h2>
      <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
        {['Stakeholder', 'Internal Process', 'Learning & Growth', 'Financial'].map(p => (
          <div key={p} className="p-4 bg-slate-50 border rounded">
            <h3 className="font-black text-[10px] mb-2">{p}</h3>
            {bsc.filter(b => b.perspective === p).map(b => <div key={b.id} className="text-[10px] mb-1">• {b.strategy}</div>)}
          </div>
        ))}
      </div>
    </section>

    <section className="mb-12">
      <h2 className="text-xl font-black flex items-center gap-2 mb-4"><Icons.ClipboardList size={18} /> Strategic Initiatives</h2>
      <div className="overflow-hidden border rounded">
        <table className="w-full text-[10px]">
          <thead>
            <tr className="bg-slate-900 text-white font-bold">
              <th className="p-2">Initiative</th>
              <th className="p-2">Unit / Person</th>
              <th className="p-2">KPI / Target / Timeline</th>
            </tr>
          </thead>
          <tbody>
            {initiatives.map(i => (
              <tr key={i.id} className="hover:bg-slate-50">
                <td className="p-2 font-bold">{i.title}</td>
                <td className="p-2">{i.unit} / {i.responsible}</td>
                <td className="p-2">
                  {i.kpi}: <span className="font-black">{i.target}</span><br/>
                  <span className="text-blue-600 font-bold">Timeline: {i.timeline}</span>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </section>

    <section>
      <h2 className="text-xl font-black flex items-center gap-2 mb-4"><Icons.Users size={18} /> Team</h2>
      <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
        {team.map(t => <div key={t.id} className="p-2 border rounded text-[10px]">{t.name} — {t.role}</div>)}
      </div>
    </section>

    <div className="mt-16 pt-8 border-t text-center no-print">
      <button onClick={() => window.print()} className="btn-primary py-3 px-10 text-xs shadow-xl">Download Official PDF</button>
    </div>
  </div>
);

const SettingsView = ({ apiKey, saveApiKey }) => {
  const [tempKey, setTempKey] = useState(apiKey);
  return (
    <div className="max-w-2xl mx-auto">
      <div className="bg-white p-6 rounded-xl shadow-md border border-slate-200">
        <h2 className="text-xl font-bold mb-4">OpenAI API Settings</h2>
        <div className="space-y-4">
          <input
            type="password"
            value={tempKey}
            onChange={e => setTempKey(e.target.value)}
            className="input-field"
            placeholder="Enter your OpenAI API key"
          />
          <button
            onClick={() => saveApiKey(tempKey)}
            className="btn-primary w-full"
            disabled={!tempKey.trim()}
          >
            Save API Key
          </button>
        </div>
        <div className="mt-4 text-slate-500 text-sm p-3 bg-slate-50 rounded">
          Get your key from <a href="https://platform.openai.com/api-keys" target="_blank" className="text-blue-600">OpenAI Platform</a>
        </div>
      </div>
    </div>
  );
};

// Render
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
</script>
</body>
</html>
