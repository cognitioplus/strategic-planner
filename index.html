<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Strategic Planner - Comprehensive strategic planning tool with AI assistance">
<meta name="theme-color" content="#1e293b">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Strategic Planner</title>
<style>
/* ... (your full CSS stays exactly as-is — no changes needed) ... */
</style>
</head>
<body>
<a href="#main-content" class="skip-link">Skip to main content</a>
<div id="root"></div>

<!-- External Scripts -->
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<script type="text/babel">
const { useState, useEffect, useMemo, useRef } = React;

// --- ICONS (your existing Icons block unchanged) ---
const Icon = ({ path, size = 20, className = "", ariaLabel }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} role="img" aria-label={ariaLabel}>
    {path}
  </svg>
);

const Icons = {
  LayoutDashboard: (props) => <Icon {...props} ariaLabel="Dashboard" path={<><rect width="7" height="9" x="3" y="3" rx="1" /><rect width="7" height="5" x="14" y="3" rx="1" /><rect width="7" height="9" x="14" y="12" rx="1" /><rect width="7" height="5" x="3" y="16" rx="1" /></>} />,
  ClipboardList: (props) => <Icon {...props} ariaLabel="Clipboard" path={<><rect width="8" height="4" x="8" y="2" rx="1" ry="1" /><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" /><path d="M12 11h4" /><path d="M12 16h4" /><path d="M8 11h.01" /><path d="M8 16h.01" /></>} />,
  Users: (props) => <Icon {...props} ariaLabel="Users" path={<><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M22 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></>} />,
  Target: (props) => <Icon {...props} ariaLabel="Target" path={<><circle cx="12" cy="12" r="10" /><circle cx="12" cy="12" r="6" /><circle cx="12" cy="12" r="2" /></>} />,
  PieChart: (props) => <Icon {...props} ariaLabel="Chart" path={<><path d="M21.21 15.89A10 10 0 1 1 8 2.83" /><path d="M22 12A10 10 0 0 0 12 2v10z" /></>} />,
  FileText: (props) => <Icon {...props} ariaLabel="Document" path={<><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z" /><path d="M14 2v4a2 2 0 0 0 2 2h4" /><path d="M10 9H8" /><path d="M16 13H8" /><path d="M16 17H8" /></>} />,
  Plus: (props) => <Icon {...props} ariaLabel="Add" path={<><path d="M5 12h14" /><path d="M12 5v14" /></>} />,
  Trash2: (props) => <Icon {...props} ariaLabel="Delete" path={<><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /><line x1="10" x2="10" y1="11" y2="17" /><line x1="14" x2="14" y1="11" y2="17" /></>} />,
  Pencil: (props) => <Icon {...props} ariaLabel="Edit" path={<><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" /><path d="m15 5 4 4" /></>} />,
  Menu: (props) => <Icon {...props} ariaLabel="Menu" path={<><line x1="4" x2="20" y1="12" y2="12" /><line x1="4" x2="20" y1="6" y2="6" /><line x1="4" x2="20" y1="18" y2="18" /></>} />,
  X: (props) => <Icon {...props} ariaLabel="Close" path={<><path d="M18 6 6 18" /><path d="m6 6 12 12" /></>} />,
  Sparkles: (props) => <Icon {...props} ariaLabel="AI" path={<><path d="M10 5.026a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v1.98a1 1 0 0 1-1 1H11a1 1 0 0 1-1-1V5.026z" /><path d="m2 5 10-3 10 3-10 3L2 5z" /><path d="M7 9h10a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2z" /></>} />,
  Loader: (props) => <Icon {...props} ariaLabel="Loading" path={<><path d="M12 2v4" /><path d="M12 18v4" /><path d="m4.93 4.93 2.83 2.83" /><path d="m16.24 16.24 2.83 2.83" /><path d="M2 12h4" /><path d="M18 12h4" /><path d="m6.93 19.07 2.83-2.83" /><path d="m19.07 6.93-2.83 2.83" /></>} />,
};

// --- DATA SERVICE ---
const DataService = {
  get: (key) => JSON.parse(localStorage.getItem(key)) || [],
  set: (key, data) => localStorage.setItem(key, JSON.stringify(data)),
  add: (collection, item) => {
    const newItem = { ...item, id: Date.now().toString() };
    const updated = [newItem, ...DataService.get(collection)];
    DataService.set(collection, updated);
    return updated;
  },
  update: (collection, id, updates) => {
    const updated = DataService.get(collection).map(item => item.id === id ? { ...item, ...updates } : item);
    DataService.set(collection, updated);
    return updated;
  },
  delete: (collection, id) => {
    const updated = DataService.get(collection).filter(item => item.id !== id);
    DataService.set(collection, updated);
    return updated;
  }
};

// --- AI SERVICE (OpenAI GPT) ---
const AIService = {
  async generate(userPrompt, systemPrompt, schema, apiKey) {
    if (!apiKey) throw new Error("API key is required");
    const maxRetries = 3;
    for (let retries = 0; retries < maxRetries; retries++) {
      try {
        const jsonInstruction = `Respond ONLY with valid JSON matching: ${JSON.stringify(schema)}. No other text.`;
        const res = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
          body: JSON.stringify({
            model: "gpt-4o-mini",
            messages: [
              { role: "system", content: systemPrompt },
              { role: "user", content: userPrompt + "\n\n" + jsonInstruction }
            ],
            temperature: 0.4,
            response_format: { type: "json_object" }
          })
        });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        return JSON.parse(data.choices[0].message.content);
      } catch (e) {
        if (retries === maxRetries - 1) throw e;
        await new Promise(r => setTimeout(r, 1000 * Math.pow(2, retries)));
      }
    }
  }
};

// --- COMPONENTS ---
const NavButton = ({ active, onClick, icon, children }) => (
  <button onClick={onClick} className={`nav-button ${active ? 'active' : ''}`}>
    {icon} <span>{children}</span>
  </button>
);

const StatCard = ({ title, value, icon }) => (
  <div className="stat-card">
    <div>
      <p className="text-slate-500 text-sm">{title}</p>
      <p className="text-2xl font-bold">{value}</p>
    </div>
    {icon}
  </div>
);

// --- MAIN APP ---
const App = () => {
  const [activeTab, setActiveTab] = useState('dashboard');
  const [isSidebarOpen, setIsSidebarOpen] = useState(false);
  
  // Data states
  const [objectives, setObjectives] = useState([]);
  const [swot, setSwot] = useState([]);
  const [strategies, setStrategies] = useState(null);
  const [bsc, setBsc] = useState([]);
  const [initiatives, setInitiatives] = useState([]);
  const [team, setTeam] = useState([]);
  
  // AI state
  const [apiKey, setApiKey] = useState(localStorage.getItem('openaiApiKey') || '');
  const [generating, setGenerating] = useState(false);
  
  // Load data
  useEffect(() => {
    setObjectives(DataService.get('objectives'));
    setSwot(DataService.get('swot'));
    setBsc(DataService.get('bsc'));
    setInitiatives(DataService.get('initiatives'));
    setTeam(DataService.get('team'));
  }, []);

  const saveApiKey = (key) => {
    setApiKey(key);
    localStorage.setItem('openaiApiKey', key);
  };

  const handleGenerateStrategies = async () => {
    if (!apiKey) return alert("Please set your OpenAI API key in AI Settings.");
    if (swot.length < 2) return alert("Add at least 2 SWOT items.");
    
    setGenerating(true);
    try {
      const strengths = swot.filter(s => s.type === 'Strength').map(s => s.text).join('; ');
      const weaknesses = swot.filter(s => s.type === 'Weakness').map(s => s.text).join('; ');
      const opportunities = swot.filter(s => s.type === 'Opportunity').map(s => s.text).join('; ');
      const threats = swot.filter(s => s.type === 'Threat').map(s => s.text).join('; ');
      
      const prompt = `Generate 4 strategic options from this SWOT for an organization:
Strengths: ${strengths || 'None'}
Weaknesses: ${weaknesses || 'None'}
Opportunities: ${opportunities || 'None'}
Threats: ${threats || 'None'}`;
      
      const system = "You are a strategic planning expert. Output only JSON with keys: so, st, wo, wt. Each value is one actionable sentence.";
      const schema = { type: "object", properties: { so: { type: "string" }, st: { type: "string" }, wo: { type: "string" }, wt: { type: "string" } } };
      
      const result = await AIService.generate(prompt, system, schema, apiKey);
      setStrategies(result);
    } catch (e) {
      alert("AI error: " + e.message);
    } finally {
      setGenerating(false);
    }
  };

  const handleGenerateKPI = async (strategy, perspective) => {
    if (!apiKey) return;
    const prompt = `Suggest one measurable KPI for: "${strategy}" in the ${perspective} perspective.`;
    const system = "You are a performance management expert. Respond with ONLY the KPI text.";
    try {
      const res = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
        body: JSON.stringify({
          model: "gpt-4o-mini",
          messages: [{ role: "user", content: prompt }],
          temperature: 0.3,
          max_tokens: 50
        })
      });
      const data = await res.json();
      return data.choices[0].message.content.trim();
    } catch (e) {
      return "Define success metric";
    }
  };

  // --- RENDER VIEWS ---
  const DashboardView = () => {
    const stats = {
      objectives: objectives.length,
      initiatives: initiatives.length,
      team: team.length,
      swot: swot.length
    };
    return (
      <div className="p-6">
        <h2 className="text-2xl font-bold mb-6">Strategic Dashboard</h2>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
          <StatCard title="Strategic Objectives" value={stats.objectives} icon={<Icons.Target size={24} className="text-blue-500" />} />
          <StatCard title="SWOT Items" value={stats.swot} icon={<Icons.Target size={24} className="text-purple-500" />} />
          <StatCard title="Initiatives" value={stats.initiatives} icon={<Icons.ClipboardList size={24} className="text-emerald-500" />} />
          <StatCard title="Team Members" value={stats.team} icon={<Icons.Users size={24} className="text-orange-500" />} />
        </div>
      </div>
    );
  };

  const ObjectivesView = () => {
    const [form, setForm] = useState({ text: '', type: 'Strength' });
    const [editing, setEditing] = useState(null);

    const submit = (e) => {
      e.preventDefault();
      if (editing) {
        DataService.update('swot', editing, form);
        setSwot(DataService.get('swot'));
      } else {
        DataService.add('swot', form);
        setSwot(DataService.get('swot'));
      }
      setForm({ text: '', type: 'Strength' });
      setEditing(null);
    };

    return (
      <div className="p-6">
        <h2 className="text-2xl font-bold mb-6">Objectives & SWOT Analysis</h2>
        
        {/* SWOT Form */}
        <form onSubmit={submit} className="card p-4 mb-6">
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <select value={form.type} onChange={e => setForm({...form, type: e.target.value})} className="input-field">
              {['Strength', 'Weakness', 'Opportunity', 'Threat'].map(t => <option key={t} value={t}>{t}</option>)}
            </select>
            <div className="md:col-span-1">
              <input
                value={form.text}
                onChange={e => setForm({...form, text: e.target.value})}
                className="input-field"
                placeholder="Enter SWOT detail..."
                required
              />
            </div>
            <div className="md:col-span-2 flex justify-end gap-2">
              <button type="submit" className="btn-primary">{editing ? 'Update' : 'Add SWOT'}</button>
            </div>
          </div>
        </form>

        {/* SWOT Display */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
          {['Strength', 'Weakness', 'Opportunity', 'Threat'].map(type => (
            <div key={type} className="card p-4">
              <h3 className={`font-bold mb-2 ${type === 'Strength' ? 'text-emerald-700' : type === 'Weakness' ? 'text-orange-700' : type === 'Opportunity' ? 'text-blue-700' : 'text-red-700'}`}>
                {type}{type === 'Opportunity' ? 's' : 's'}
              </h3>
              <ul className="space-y-2">
                {swot.filter(s => s.type === type).map(item => (
                  <li key={item.id} className="flex justify-between items-start p-2 bg-slate-50 rounded">
                    <span>{item.text}</span>
                    <div className="space-x-2">
                      <button onClick={() => { setEditing(item.id); setForm(item); }} className="text-blue-500"><Icons.Pencil size={14} /></button>
                      <button onClick={() => { DataService.delete('swot', item.id); setSwot(DataService.get('swot')); }} className="text-red-500"><Icons.Trash2 size={14} /></button>
                    </div>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </div>

        {/* AI Strategies */}
        <div className="card p-4">
          <div className="flex justify-between items-center mb-4">
            <h3 className="font-bold">AI Strategic Recommendations</h3>
            <button
              onClick={handleGenerateStrategies}
              disabled={generating}
              className="btn-primary flex items-center gap-1"
            >
              {generating ? 'Generating...' : <><Icons.Sparkles size={16} /> Generate</>}
            </button>
          </div>
          {strategies && (
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              {Object.entries(strategies).map(([key, desc]) => (
                <div key={key} className="p-3 bg-slate-50 rounded border-l-4 border-blue-500">
                  <div className="font-bold text-sm uppercase">{key.toUpperCase()} Strategy</div>
                  <div>"{desc}"</div>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    );
  };

  const BscView = () => {
    const [form, setForm] = useState({ strategy: '', perspective: 'Stakeholder', kpi: '' });
    const [editing, setEditing] = useState(null);

    const suggestKPI = async () => {
      if (!form.strategy || !apiKey) return;
      const kpi = await handleGenerateKPI(form.strategy, form.perspective);
      setForm({...form, kpi});
    };

    const submit = (e) => {
      e.preventDefault();
      if (editing) {
        DataService.update('bsc', editing, form);
        setBsc(DataService.get('bsc'));
      } else {
        DataService.add('bsc', form);
        setBsc(DataService.get('bsc'));
      }
      setForm({ strategy: '', perspective: 'Stakeholder', kpi: '' });
      setEditing(null);
    };

    return (
      <div className="p-6">
        <h2 className="text-2xl font-bold mb-6">Balanced Scorecard</h2>
        <form onSubmit={submit} className="card p-4 mb-6">
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <input
              value={form.strategy}
              onChange={e => setForm({...form, strategy: e.target.value})}
              className="input-field"
              placeholder="Strategic Objective"
              required
              onBlur={suggestKPI}
            />
            <select value={form.perspective} onChange={e => setForm({...form, perspective: e.target.value})} className="input-field">
              {['Stakeholder', 'Internal Process', 'Learning & Growth', 'Financial'].map(p => <option key={p} value={p}>{p}</option>)}
            </select>
            <input
              value={form.kpi}
              onChange={e => setForm({...form, kpi: e.target.value})}
              className="input-field"
              placeholder="KPI / Success Measure"
              required
            />
            <div className="md:col-span-3 flex justify-end gap-2">
              <button type="submit" className="btn-primary">{editing ? 'Update' : 'Add Objective'}</button>
            </div>
          </div>
        </form>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          {['Stakeholder', 'Internal Process', 'Learning & Growth', 'Financial'].map(p => (
            <div key={p} className="card p-4">
              <h3 className="font-bold mb-2 text-center">{p}</h3>
              <ul className="space-y-2">
                {bsc.filter(b => b.perspective === p).map(item => (
                  <li key={item.id} className="p-2 bg-slate-50 rounded flex justify-between">
                    <div>
                      <div>{item.strategy}</div>
                      <div className="text-xs text-blue-600">KPI: {item.kpi}</div>
                    </div>
                    <div className="space-x-2">
                      <button onClick={() => { setEditing(item.id); setForm(item); }} className="text-blue-500"><Icons.Pencil size={14} /></button>
                      <button onClick={() => { DataService.delete('bsc', item.id); setBsc(DataService.get('bsc')); }} className="text-red-500"><Icons.Trash2 size={14} /></button>
                    </div>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </div>
      </div>
    );
  };

  const InitiativesView = () => {
    const [form, setForm] = useState({ title: '', kpi: '', target: '', timeline: '', responsible: '', unit: '' });
    const [editing, setEditing] = useState(null);

    const submit = (e) => {
      e.preventDefault();
      if (editing) {
        DataService.update('initiatives', editing, form);
        setInitiatives(DataService.get('initiatives'));
      } else {
        DataService.add('initiatives', form);
        setInitiatives(DataService.get('initiatives'));
      }
      setForm({ title: '', kpi: '', target: '', timeline: '', responsible: '', unit: '' });
      setEditing(null);
    };

    return (
      <div className="p-6">
        <h2 className="text-2xl font-bold mb-6">Strategic Initiatives</h2>
        <form onSubmit={submit} className="card p-4 mb-6">
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <input className="input-field" placeholder="Initiative Title" value={form.title} onChange={e => setForm({...form, title: e.target.value})} required />
            <input className="input-field" placeholder="Responsible Unit" value={form.unit} onChange={e => setForm({...form, unit: e.target.value})} required />
            <input className="input-field" placeholder="Responsible Person" value={form.responsible} onChange={e => setForm({...form, responsible: e.target.value})} required />
            <input className="input-field" placeholder="KPI" value={form.kpi} onChange={e => setForm({...form, kpi: e.target.value})} required />
            <input className="input-field" placeholder="Target" value={form.target} onChange={e => setForm({...form, target: e.target.value})} required />
            <input className="input-field" placeholder="Timeline" value={form.timeline} onChange={e => setForm({...form, timeline: e.target.value})} required />
            <div className="lg:col-span-3 flex justify-end gap-2">
              <button type="submit" className="btn-primary">{editing ? 'Update' : 'Add Initiative'}</button>
            </div>
          </div>
        </form>

        <div className="card overflow-x-auto">
          <table className="w-full">
            <thead>
              <tr className="text-left border-b">
                <th className="p-3">Initiative</th>
                <th className="p-3">Unit / Person</th>
                <th className="p-3">KPI / Target</th>
                <th className="p-3">Timeline</th>
                <th className="p-3">Actions</th>
              </tr>
            </thead>
            <tbody>
              {initiatives.map(item => (
                <tr key={item.id} className="border-b hover:bg-blue-50">
                  <td className="p-3">{item.title}</td>
                  <td className="p-3">{item.unit} / {item.responsible}</td>
                  <td className="p-3">{item.kpi}: <span className="font-bold">{item.target}</span></td>
                  <td className="p-3">{item.timeline}</td>
                  <td className="p-3 space-x-2">
                    <button onClick={() => { setEditing(item.id); setForm(item); }} className="text-blue-500"><Icons.Pencil size={16} /></button>
                    <button onClick={() => { DataService.delete('initiatives', item.id); setInitiatives(DataService.get('initiatives')); }} className="text-red-500"><Icons.Trash2 size={16} /></button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    );
  };

  const TeamView = () => {
    const [form, setForm] = useState({ name: '', role: '' });
    const [editing, setEditing] = useState(null);

    const submit = (e) => {
      e.preventDefault();
      if (editing) {
        DataService.update('team', editing, form);
        setTeam(DataService.get('team'));
      } else {
        DataService.add('team', form);
        setTeam(DataService.get('team'));
      }
      setForm({ name: '', role: '' });
      setEditing(null);
    };

    return (
      <div className="p-6">
        <h2 className="text-2xl font-bold mb-6">Team & Governance</h2>
        <form onSubmit={submit} className="card p-4 mb-6">
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <input
              value={form.name}
              onChange={e => setForm({...form, name: e.target.value})}
              className="input-field"
              placeholder="Full Name"
              required
            />
            <input
              value={form.role}
              onChange={e => setForm({...form, role: e.target.value})}
              className="input-field"
              placeholder="Role / Position"
              required
            />
            <div className="md:col-span-2 flex justify-end gap-2">
              <button type="submit" className="btn-primary">{editing ? 'Update' : 'Add Member'}</button>
            </div>
          </div>
        </form>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {team.map(member => (
            <div key={member.id} className="card p-4">
              <div className="font-bold text-lg">{member.name}</div>
              <div className="text-blue-600">{member.role}</div>
              <div className="mt-4 flex justify-end space-x-2">
                <button onClick={() => { setEditing(member.id); setForm(member); }} className="text-blue-500"><Icons.Pencil size={16} /></button>
                <button onClick={() => { DataService.delete('team', member.id); setTeam(DataService.get('team')); }} className="text-red-500"><Icons.Trash2 size={16} /></button>
              </div>
            </div>
          ))}
        </div>
      </div>
    );
  };

  const ReportView = () => {
    return (
      <div className="p-6 printable-content max-w-4xl mx-auto bg-white shadow-2xl rounded">
        <div className="text-center mb-8">
          <h1 className="text-3xl font-bold">Strategic Plan</h1>
          <p className="text-blue-600">Generated on {new Date().toLocaleDateString()}</p>
        </div>

        <section className="mb-8">
          <h2 className="text-xl font-bold mb-4 flex items-center gap-2"><Icons.Target size={20} /> SWOT Analysis</h2>
          {['Strength', 'Weakness', 'Opportunity', 'Threat'].map(type => (
            <div key={type} className="mb-4">
              <h3 className="font-bold">{type}{type === 'Opportunity' ? 's' : 's'}:</h3>
              <ul className="list-disc pl-5">
                {swot.filter(s => s.type === type).map(s => <li key={s.id}>{s.text}</li>)}
              </ul>
            </div>
          ))}
        </section>

        {strategies && (
          <section className="mb-8">
            <h2 className="text-xl font-bold mb-4 flex items-center gap-2"><Icons.Sparkles size={20} /> Strategic Recommendations</h2>
            {Object.entries(strategies).map(([key, desc]) => (
              <div key={key} className="mb-2 italic">• {desc}</div>
            ))}
          </section>
        )}

        <section className="mb-8">
          <h2 className="text-xl font-bold mb-4 flex items-center gap-2"><Icons.PieChart size={20} /> Balanced Scorecard</h2>
          {['Stakeholder', 'Internal Process', 'Learning & Growth', 'Financial'].map(p => (
            <div key={p} className="mb-4">
              <h3 className="font-bold">{p} Perspective:</h3>
              <ul className="list-disc pl-5">
                {bsc.filter(b => b.perspective === p).map(b => <li key={b.id}>{b.strategy} — <span className="font-bold">KPI:</span> {b.kpi}</li>)}
              </ul>
            </div>
          ))}
        </section>

        <section className="mb-8">
          <h2 className="text-xl font-bold mb-4 flex items-center gap-2"><Icons.ClipboardList size={20} /> Strategic Initiatives</h2>
          <table className="w-full border-collapse">
            <thead>
              <tr className="border-b">
                <th className="text-left p-2">Initiative</th>
                <th className="text-left p-2">Responsible</th>
                <th className="text-left p-2">KPI / Target</th>
                <th className="text-left p-2">Timeline</th>
              </tr>
            </thead>
            <tbody>
              {initiatives.map(i => (
                <tr key={i.id} className="border-b">
                  <td className="p-2">{i.title}</td>
                  <td className="p-2">{i.unit} / {i.responsible}</td>
                  <td className="p-2">{i.kpi}: {i.target}</td>
                  <td className="p-2">{i.timeline}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </section>

        <section>
          <h2 className="text-xl font-bold mb-4 flex items-center gap-2"><Icons.Users size={20} /> Team</h2>
          <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
            {team.map(t => <div key={t.id} className="p-2 border rounded">{t.name} — {t.role}</div>)}
          </div>
        </section>

        <div className="mt-8 text-center no-print">
          <button onClick={() => window.print()} className="btn-primary">Download as PDF</button>
        </div>
      </div>
    );
  };

  const SettingsModal = ({ isOpen, onClose }) => {
    const [tempKey, setTempKey] = useState(apiKey);
    if (!isOpen) return null;
    return (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-100">
        <div className="bg-white rounded-xl p-6 w-full max-w-md">
          <div className="flex justify-between items-center mb-4">
            <h3 className="font-bold">OpenAI API Key</h3>
            <button onClick={onClose}><Icons.X /></button>
          </div>
          <input
            type="password"
            value={tempKey}
            onChange={e => setTempKey(e.target.value)}
            className="input-field w-full mb-4"
            placeholder="Enter your OpenAI API key"
          />
          <div className="flex gap-2">
            <button
              className="btn-primary flex-1"
              onClick={() => { saveApiKey(tempKey); onClose(); }}
            >
              Save
            </button>
            <button className="px-4 py-2 border rounded" onClick={onClose}>Cancel</button>
          </div>
          <p className="text-xs text-slate-500 mt-2">
            Get your key from <a href="https://platform.openai.com/api-keys" target="_blank" className="text-blue-600">OpenAI Platform</a>
          </p>
        </div>
      </div>
    );
  };

  // --- RENDER ---
  const renderContent = () => {
    switch (activeTab) {
      case 'dashboard': return <DashboardView />;
      case 'objectives': return <ObjectivesView />;
      case 'bsc': return <BscView />;
      case 'initiatives': return <InitiativesView />;
      case 'team': return <TeamView />;
      case 'reports': return <ReportView />;
      default: return <DashboardView />;
    }
  };

  return (
    <div className="app-layout">
      <aside className={`sidebar ${isSidebarOpen ? 'open' : ''}`}>
        <div className="p-6 border-b border-slate-700">
          <h1 className="text-xl font-bold text-white">Strategic Planner</h1>
          <p className="text-sm text-slate-400 mt-1">Universal Edition</p>
        </div>
        <nav className="p-4">
          <NavButton active={activeTab === 'dashboard'} onClick={() => setActiveTab('dashboard')} icon={<Icons.LayoutDashboard />}>Dashboard</NavButton>
          <NavButton active={activeTab === 'objectives'} onClick={() => setActiveTab('objectives')} icon={<Icons.Target />}>Objectives & SWOT</NavButton>
          <NavButton active={activeTab === 'bsc'} onClick={() => setActiveTab('bsc')} icon={<Icons.PieChart />}>Balanced Scorecard</NavButton>
          <NavButton active={activeTab === 'initiatives'} onClick={() => setActiveTab('initiatives')} icon={<Icons.ClipboardList />}>Initiatives</NavButton>
          <NavButton active={activeTab === 'team'} onClick={() => setActiveTab('team')} icon={<Icons.Users />}>Team</NavButton>
          <NavButton active={activeTab === 'reports'} onClick={() => setActiveTab('reports')} icon={<Icons.FileText />}>Reports</NavButton>
        </nav>
      </aside>

      <main className="main-content" id="main-content">
        <header className="bg-white border-b p-4 flex justify-between items-center">
          <button onClick={() => setIsSidebarOpen(true)} className="md:hidden"><Icons.Menu /></button>
          <div className="text-lg font-bold">Strategic Planner</div>
          <button
            onClick={() => setIsSidebarOpen(true)}
            className="md:hidden p-2 rounded hover:bg-slate-100"
          >
            <Icons.Menu />
          </button>
          <button
            onClick={() => document.getElementById('settings-modal-trigger').click()}
            className="flex items-center gap-1 px-3 py-1 bg-slate-100 rounded text-sm"
          >
            <Icons.Sparkles size={16} className="text-purple-500" />
            AI Settings
          </button>
        </header>
        {renderContent()}
      </main>

      <button id="settings-modal-trigger" className="hidden" onClick={() => {}}></button>
      <SettingsModal isOpen={document.getElementById('settings-modal-trigger')?.hasAttribute('data-open')} onClose={() => {}} />
    </div>
  );
};

// Render
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
</script>
</body>
</html>
