<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Strategic Planner - Comprehensive strategic planning tool with AI assistance">
<meta name="theme-color" content="#1e293b">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Strategic Planner</title>
<link rel="preconnect" href="https://unpkg.com">
<style>
/* CSS Reset & Base Styles */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.5; -webkit-font-smoothing: antialiased; }
body { background: #f1f5f9; color: #1e293b; overflow-x: hidden; }
button, input, select, textarea { font: inherit; }
img, svg { display: block; max-width: 100%; }
button { cursor: pointer; border: none; background: none; }

/* Scrollbar Styles */
::-webkit-scrollbar { width: 8px; height: 8px; }
::-webkit-scrollbar-track { background: #f1f5f9; }
::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

/* Utility Classes */
.container { max-width: 90rem; margin: 0 auto; padding: 1.5rem; }
.flex { display: flex; }
.flex-col { flex-direction: column; }
.items-center { align-items: center; }
.justify-between { justify-content: space-between; }
.justify-center { justify-content: center; }
.gap-2 { gap: 0.5rem; }
.gap-4 { gap: 1rem; }
.gap-6 { gap: 1.5rem; }
.grid { display: grid; }
.grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
.hidden { display: none; }
.sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border-width: 0; }

/* Typography */
.text-xs { font-size: 0.75rem; }
.text-sm { font-size: 0.875rem; }
.text-base { font-size: 1rem; }
.text-lg { font-size: 1.125rem; }
.text-xl { font-size: 1.25rem; }
.text-2xl { font-size: 1.5rem; }
.text-3xl { font-size: 1.875rem; }
.font-medium { font-weight: 500; }
.font-semibold { font-weight: 600; }
.font-bold { font-weight: 700; }
.font-black { font-weight: 900; }
.uppercase { text-transform: uppercase; }
.italic { font-style: italic; }
.tracking-wide { letter-spacing: 0.025em; }
.tracking-wider { letter-spacing: 0.05em; }
.leading-relaxed { line-height: 1.625; }
.text-center { text-align: center; }
.text-right { text-align: right; }

/* Colors */
.text-white { color: #fff; }
.text-slate-300 { color: #cbd5e1; }
.text-slate-400 { color: #94a3b8; }
.text-slate-500 { color: #64748b; }
.text-slate-600 { color: #475569; }
.text-slate-700 { color: #334155; }
.text-slate-800 { color: #1e293b; }
.text-slate-900 { color: #0f172a; }
.text-blue-400 { color: #60a5fa; }
.text-blue-500 { color: #3b82f6; }
.text-blue-600 { color: #2563eb; }
.text-emerald-500 { color: #10b981; }
.text-emerald-600 { color: #059669; }
.text-emerald-700 { color: #047857; }
.text-orange-700 { color: #c2410c; }
.text-purple-500 { color: #a855f7; }
.text-purple-600 { color: #9333ea; }
.text-red-500 { color: #ef4444; }
.text-red-600 { color: #dc2626; }
.text-red-700 { color: #b91c1c; }
.bg-white { background-color: #fff; }
.bg-slate-50 { background-color: #f8fafc; }
.bg-slate-100 { background-color: #f1f5f9; }
.bg-slate-800 { background-color: #1e293b; }
.bg-slate-900 { background-color: #0f172a; }
.bg-blue-50 { background-color: #eff6ff; }
.bg-blue-600 { background-color: #2563eb; }
.bg-emerald-50 { background-color: #ecfdf5; }
.bg-emerald-100 { background-color: #d1fae5; }
.bg-orange-50 { background-color: #fff7ed; }
.bg-purple-50 { background-color: #faf5ff; }
.bg-red-50 { background-color: #fef2f2; }

/* Spacing */
.p-1 { padding: 0.25rem; }
.p-2 { padding: 0.5rem; }
.p-3 { padding: 0.75rem; }
.p-4 { padding: 1rem; }
.p-5 { padding: 1.25rem; }
.p-6 { padding: 1.5rem; }
.p-8 { padding: 2rem; }
.p-10 { padding: 2.5rem; }
.px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
.px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
.px-4 { padding-left: 1rem; padding-right: 1rem; }
.px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
.px-10 { padding-left: 2.5rem; padding-right: 2.5rem; }
.py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
.py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
.py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
.py-4 { padding-top: 1rem; padding-bottom: 1rem; }
.m-2 { margin: 0.5rem; }
.mb-1 { margin-bottom: 0.25rem; }
.mb-2 { margin-bottom: 0.5rem; }
.mb-3 { margin-bottom: 0.75rem; }
.mb-4 { margin-bottom: 1rem; }
.mb-6 { margin-bottom: 1.5rem; }
.mt-1 { margin-top: 0.25rem; }
.mt-2 { margin-top: 0.5rem; }
.mt-3 { margin-top: 0.75rem; }
.mt-4 { margin-top: 1rem; }
.mt-16 { margin-top: 4rem; }
.ml-1 { margin-left: 0.25rem; }
.ml-2 { margin-left: 0.5rem; }
.mr-2 { margin-right: 0.5rem; }

/* Borders & Shadows */
.border { border: 1px solid #e2e8f0; }
.border-2 { border: 2px solid; }
.border-t { border-top: 1px solid #e2e8f0; }
.border-b { border-bottom: 1px solid #e2e8f0; }
.border-l-4 { border-left: 4px solid; }
.border-slate-100 { border-color: #f1f5f9; }
.border-slate-200 { border-color: #e2e8f0; }
.border-slate-700 { border-color: #334155; }
.border-slate-900 { border-color: #0f172a; }
.border-emerald-200 { border-color: #a7f3d0; }
.border-l-emerald-500 { border-left-color: #10b981; }
.border-l-red-500 { border-left-color: #ef4444; }
.border-l-blue-500 { border-left-color: #3b82f6; }
.border-l-slate-500 { border-left-color: #64748b; }
.rounded { border-radius: 0.25rem; }
.rounded-lg { border-radius: 0.5rem; }
.rounded-xl { border-radius: 0.75rem; }
.rounded-full { border-radius: 9999px; }
.shadow-sm { box-shadow: 0 1px 2px 0 rgba(0,0,0,0.05); }
.shadow-md { box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
.shadow-xl { box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
.shadow-2xl { box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); }

/* Layout */
.w-full { width: 100%; }
.w-5 { width: 1.25rem; }
.w-8 { width: 2rem; }
.w-16 { width: 4rem; }
.w-64 { width: 16rem; }
.h-5 { height: 1.25rem; }
.h-8 { height: 2rem; }
.h-16 { height: 4rem; }
.h-32 { height: 8rem; }
.h-screen { height: 100vh; }
.max-w-2xl { max-width: 42rem; }
.max-w-5xl { max-width: 64rem; }
.max-w-7xl { max-width: 80rem; }
.mx-auto { margin-left: auto; margin-right: auto; }
.overflow-hidden { overflow: hidden; }
.overflow-auto { overflow: auto; }
.overflow-x-auto { overflow-x: auto; }

/* Positioning */
.relative { position: relative; }
.absolute { position: absolute; }
.fixed { position: fixed; }
.sticky { position: sticky; }
.top-0 { top: 0; }
.top-2 { top: 0.5rem; }
.top-4 { top: 1rem; }
.right-2 { right: 0.5rem; }
.right-4 { right: 1rem; }
.inset-0 { top: 0; right: 0; bottom: 0; left: 0; }
.inset-y-0 { top: 0; bottom: 0; }
.left-0 { left: 0; }
.z-20 { z-index: 20; }
.z-50 { z-index: 50; }
.z-100 { z-index: 100; }

/* Transitions */
.transition-all { transition: all 150ms cubic-bezier(0.4, 0, 0.2, 1); }
.transition-colors { transition: color 150ms, background-color 150ms; }
.transition-opacity { transition: opacity 150ms; }
.transition-shadow { transition: box-shadow 150ms; }
.transition-transform { transition: transform 300ms; }
.duration-300 { transition-duration: 300ms; }

/* Hover States */
.hover\:bg-slate-700:hover { background-color: #334155; }
.hover\:bg-slate-800:hover { background-color: #1e293b; }
.hover\:bg-blue-100:hover { background-color: #dbeafe; }
.hover\:bg-blue-700:hover { background-color: #1d4ed8; }
.hover\:bg-purple-100:hover { background-color: #f3e8ff; }
.hover\:bg-white:hover { background-color: #fff; }
.hover\:text-white:hover { color: #fff; }
.hover\:text-slate-700:hover { color: #334155; }
.hover\:text-blue-500:hover { color: #3b82f6; }
.hover\:text-blue-600:hover { color: #2563eb; }
.hover\:text-red-500:hover { color: #ef4444; }
.hover\:text-red-600:hover { color: #dc2626; }
.hover\:border-blue-200:hover { border-color: #bfdbfe; }
.hover\:shadow-md:hover { box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }

/* Form Styles */
.input-field {
width: 100%;
padding: 0.5rem 1rem;
background-color: #fff;
border: 1px solid #cbd5e1;
border-radius: 0.5rem;
font-size: 0.875rem;
transition: all 150ms;
}
.input-field:focus {
outline: none;
border-color: #3b82f6;
box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}
.input-field:disabled {
opacity: 0.5;
cursor: not-allowed;
}

/* Button Styles */
.btn-primary {
display: inline-flex;
align-items: center;
justify-content: center;
padding: 0.5rem 1.5rem;
background-color: #2563eb;
color: #fff;
font-weight: 600;
border-radius: 0.5rem;
box-shadow: 0 1px 2px 0 rgba(0,0,0,0.05);
transition: all 150ms;
}
.btn-primary:hover:not(:disabled) { background-color: #1d4ed8; }
.btn-primary:disabled {
opacity: 0.5;
cursor: not-allowed;
}

/* Table Styles */
table { border-collapse: collapse; width: 100%; }
thead { background-color: #f8fafc; border-bottom: 1px solid #e2e8f0; }
tbody tr { border-bottom: 1px solid #f1f5f9; }
tbody tr:hover { background-color: rgba(239, 246, 255, 0.3); }
th, td { padding: 1rem; text-align: left; }

/* Navigation Styles */
.nav-button {
width: 100%;
display: flex;
align-items: center;
gap: 0.75rem;
padding: 0.75rem 1rem;
border-radius: 0.5rem;
font-weight: 500;
color: #cbd5e1;
transition: all 150ms;
}
.nav-button:hover { background-color: #1e293b; }
.nav-button.active {
background-color: #2563eb;
color: #fff;
box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
}

/* Card Styles */
.card {
background-color: #fff;
border: 1px solid #e2e8f0;
border-radius: 0.75rem;
box-shadow: 0 1px 2px 0 rgba(0,0,0,0.05);
}
.stat-card {
background-color: #fff;
padding: 1.5rem;
border: 1px solid #e2e8f0;
border-radius: 0.75rem;
box-shadow: 0 1px 2px 0 rgba(0,0,0,0.05);
display: flex;
justify-content: space-between;
align-items: center;
}

/* Tooltip Styles */
.tooltip-container { position: relative; display: inline-block; }
.tooltip-text {
visibility: hidden;
opacity: 0;
position: absolute;
left: 100%;
top: 50%;
transform: translateY(-50%);
margin-left: 12px;
background-color: #1e293b;
color: white;
padding: 8px 12px;
border-radius: 6px;
font-size: 12px;
white-space: nowrap;
z-index: 100;
transition: opacity 0.3s, visibility 0.3s;
box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
pointer-events: none;
}
.tooltip-text::before {
content: '';
position: absolute;
right: 100%;
top: 50%;
transform: translateY(-50%);
border: 6px solid transparent;
border-right-color: #1e293b;
}
.tooltip-container:hover .tooltip-text,
.tooltip-container:focus-within .tooltip-text {
visibility: visible;
opacity: 1;
}

/* AI Badge */
.ai-badge {
background: linear-gradient(to right, #6366f1, #9333ea);
color: white;
font-size: 10px;
padding: 0.125rem 0.5rem;
border-radius: 9999px;
font-weight: 700;
letter-spacing: 0.05em;
text-transform: uppercase;
display: inline-flex;
align-items: center;
gap: 0.25rem;
}

/* Loading Animation */
.shimmer {
background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
background-size: 200% 100%;
animation: shimmer 1.5s infinite;
}
@keyframes shimmer {
0% { background-position: 200% 0; }
100% { background-position: -200% 0; }
}
@keyframes spin {
to { transform: rotate(360deg); }
}
.animate-spin { animation: spin 1s linear infinite; }
.animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
@keyframes pulse {
0%, 100% { opacity: 1; }
50% { opacity: 0.5; }
}

/* Skip Link */
.skip-link {
position: absolute;
top: -40px;
left: 0;
background: #3b82f6;
color: white;
padding: 8px 16px;
text-decoration: none;
z-index: 100;
border-radius: 0 0 4px 0;
}
.skip-link:focus {
top: 0;
}

/* Responsive Grid */
@media (min-width: 768px) {
.md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
.md\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
.md\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
.md\:col-span-2 { grid-column: span 2 / span 2; }
.md\:col-span-3 { grid-column: span 3 / span 3; }
.md\:col-span-4 { grid-column: span 4 / span 4; }
.md\:flex-row { flex-direction: row; }
.md\:w-48 { width: 12rem; }
.md\:p-10 { padding: 2.5rem; }
.md\:relative { position: relative; }
.md\:translate-x-0 { transform: translateX(0); }
.md\:hidden { display: none; }
.md\:block { display: block; }
}
@media (min-width: 1024px) {
.lg\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
.lg\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
.lg\:col-span-3 { grid-column: span 3 / span 3; }
}

/* Sidebar Transform */
.sidebar {
position: fixed;
top: 0;
bottom: 0;
left: 0;
width: 16rem;
background-color: #0f172a;
color: white;
transform: translateX(-100%);
transition: transform 300ms;
z-index: 50;
}
.sidebar.open { transform: translateX(0); }
@media (min-width: 768px) {
.sidebar {
position: relative;
transform: translateX(0);
}
}

/* Main Layout */
.app-layout {
display: flex;
height: 100vh;
background-color: #f1f5f9;
overflow: hidden;
}
.main-content {
flex: 1;
overflow-y: auto;
}

/* Focus Visible */
*:focus-visible {
outline: 3px solid #3b82f6;
outline-offset: 2px;
}

/* Print Styles */
@media print {
body * { visibility: hidden; }
.printable-content, .printable-content * { visibility: visible; }
.printable-content {
position: absolute;
left: 0;
top: 0;
width: 100%;
box-shadow: none !important;
border: none !important;
}
.no-print { display: none !important; }
.sidebar { display: none !important; }
}

/* High Contrast Mode */
@media (prefers-contrast: high) {
.input-field { border-width: 2px; }
.btn-primary { border: 2px solid white; }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
*, *::before, *::after {
animation-duration: 0.01ms !important;
animation-iteration-count: 1 !important;
transition-duration: 0.01ms !important;
}
}

/* Opacity & Display Utilities */
.opacity-0 { opacity: 0; }
.opacity-50 { opacity: 0.5; }
.group:hover .group-hover\:opacity-100 { opacity: 1; }
.space-x-1 > * + * { margin-left: 0.25rem; }
.space-x-2 > * + * { margin-left: 0.5rem; }
.space-x-3 > * + * { margin-left: 0.75rem; }
.space-y-2 > * + * { margin-top: 0.5rem; }
.space-y-3 > * + * { margin-top: 0.75rem; }
.space-y-4 > * + * { margin-top: 1rem; }
.space-y-6 > * + * { margin-top: 1.5rem; }
.divide-y > * + * { border-top: 1px solid #f1f5f9; }
.inline-block { display: inline-block; }
.inline-flex { display: inline-flex; }
.shrink-0 { flex-shrink: 0; }
.flex-1 { flex: 1 1 0%; }
.whitespace-nowrap { white-space: nowrap; }
.tabular-nums { font-variant-numeric: tabular-nums; }

/* Min Heights */
.min-h-100 { min-height: 100px; }

/* Custom Utilities */
.text-2xs { font-size: 0.625rem; }
.tracking-tighter { letter-spacing: -0.05em; }
.pb-20 { padding-bottom: 5rem; }
.pt-2 { padding-top: 0.5rem; }
.pt-3 { padding-top: 0.75rem; }
.pt-8 { padding-top: 2rem; }
.pb-1 { padding-bottom: 0.25rem; }
.pb-2 { padding-bottom: 0.25rem; }
.pb-8 { padding-bottom: 2rem; }
.align-top { vertical-align: top; }
</style>
</head>
<body>
<a href="#main-content" class="skip-link">Skip to main content</a>
<div id="root"></div>

<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<script type="text/babel">
const { useState, useEffect, useMemo, useRef } = React;

// --- ICONS ---
const Icon = ({ path, size = 20, className = "", ariaLabel }) => (
<svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} role="img" aria-label={ariaLabel}>
{path}
</svg>
);

const Icons = {
LayoutDashboard: (props) => <Icon {...props} ariaLabel="Dashboard" path={<><rect width="7" height="9" x="3" y="3" rx="1" /><rect width="7" height="5" x="14" y="3" rx="1" /><rect width="7" height="9" x="14" y="12" rx="1" /><rect width="7" height="5" x="3" y="16" rx="1" /></>} />,
ClipboardList: (props) => <Icon {...props} ariaLabel="Clipboard" path={<><rect width="8" height="4" x="8" y="2" rx="1" ry="1" /><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" /><path d="M12 11h4" /><path d="M12 16h4" /><path d="M8 11h.01" /><path d="M8 16h.01" /></>} />,
Users: (props) => <Icon {...props} ariaLabel="Users" path={<><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M22 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></>} />,
Target: (props) => <Icon {...props} ariaLabel="Target" path={<><circle cx="12" cy="12" r="10" /><circle cx="12" cy="12" r="6" /><circle cx="12" cy="12" r="2" /></>} />,
PieChart: (props) => <Icon {...props} ariaLabel="Chart" path={<><path d="M21.21 15.89A10 10 0 1 1 8 2.83" /><path d="M22 12A10 10 0 0 0 12 2v10z" /></>} />,
FileText: (props) => <Icon {...props} ariaLabel="Document" path={<><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z" /><path d="M14 2v4a2 2 0 0 0 2 2h4" /><path d="M10 9H8" /><path d="M16 13H8" /><path d="M16 17H8" /></>} />,
Plus: (props) => <Icon {...props} ariaLabel="Add" path={<><path d="M5 12h14" /><path d="M12 5v14" /></>} />,
Trash2: (props) => <Icon {...props} ariaLabel="Delete" path={<><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /><line x1="10" x2="10" y1="11" y2="17" /><line x1="14" x2="14" y1="11" y2="17" /></>} />,
Pencil: (props) => <Icon {...props} ariaLabel="Edit" path={<><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" /><path d="m15 5 4 4" /></>} />,
Menu: (props) => <Icon {...props} ariaLabel="Menu" path={<><line x1="4" x2="20" y1="12" y2="12" /><line x1="4" x2="20" y1="6" y2="6" /><line x1="4" x2="20" y1="18" y2="18" /></>} />,
X: (props) => <Icon {...props} ariaLabel="Close" path={<><path d="M18 6 6 18" /><path d="m6 6 12 12" /></>} />,
Sparkles: (props) => <Icon {...props} ariaLabel="AI" path={<><path d="M10 5.026a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v1.98a1 1 0 0 1-1 1H11a1 1 0 0 1-1-1V5.026z" /><path d="m2 5 10-3 10 3-10 3L2 5z" /><path d="M7 9h10a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2z" /></>} />,
Loader: (props) => <Icon {...props} ariaLabel="Loading" path={<><path d="M12 2v4" /><path d="M12 18v4" /><path d="m4.93 4.93 2.83 2.83" /><path d="m16.24 16.24 2.83 2.83" /><path d="M2 12h4" /><path d="M18 12h4" /><path d="m6.93 19.07 2.83-2.83" /><path d="m19.07 6.93-2.83 2.83" /></>} />,
};

// --- AI SERVICE (OpenAI ChatGPT) ---
const openaiApiKey = ""; // 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

const AIService = {
  async generate(userPrompt, systemPrompt, schema) {
    let retries = 0;
    const maxRetries = 5;

    // Clarify JSON structure in the prompt since OpenAI doesn't enforce schemas client-side
    const jsonFormatInstruction = 
      `Respond ONLY with a valid JSON object matching this structure: ${JSON.stringify(schema, null, 2)}. ` +
      `Do not include markdown, explanations, or any text outside the JSON.`;

    const messages = [
      { role: "system", content: systemPrompt },
      { role: "user", content: userPrompt + "\n\n" + jsonFormatInstruction }
    ];

    while (retries < maxRetries) {
      try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${openaiApiKey}`
          },
          body: JSON.stringify({
            model: "gpt-4o-mini", // or "gpt-4o" for higher quality
            messages: messages,
            temperature: 0.3,
            max_tokens: 1000,
            response_format: { type: "json_object" } // Enforces JSON output
          })
        });

        if (!response.ok) {
          const error = await response.json().catch(() => ({}));
          throw new Error(`OpenAI API error: ${response.status} ${error.error?.message || "Unknown error"}`);
        }

        const data = await response.json();
        const content = data.choices[0]?.message?.content;

        if (!content) {
          throw new Error("No response content from OpenAI");
        }

        const parsed = JSON.parse(content);
        return parsed;

      } catch (e) {
        console.warn(`AI retry ${retries + 1}/${maxRetries}:`, e.message);
        retries++;
        if (retries >= maxRetries) throw new Error(`AI Service failed after ${maxRetries} retries: ${e.message}`);
        await new Promise(r => setTimeout(r, Math.pow(2, retries) * 1000));
      }
    }
  }
};

// --- STRATEGIC PLANNER COMPONENTS ---
const Sidebar = ({ activeTab, setActiveTab, handleMenuToggle, isSidebarOpen }) => {
  const navItems = [
    { id: 'dashboard', icon: Icons.LayoutDashboard, label: 'Dashboard' },
    { id: 'objectives', icon: Icons.Target, label: 'Objectives' },
    { id: 'initiatives', icon: Icons.ClipboardList, label: 'Initiatives' },
    { id: 'team', icon: Icons.Users, label: 'Team' },
    { id: 'reports', icon: Icons.PieChart, label: 'Reports' },
    { id: 'documents', icon: Icons.FileText, label: 'Documents' },
  ];

  return (
    <aside className={`sidebar ${isSidebarOpen ? 'open' : ''}`}>
      <div className="p-6 border-b border-slate-700">
        <h1 className="text-xl font-bold text-white">Strategic Planner</h1>
        <p className="text-sm text-slate-400 mt-1">Universal Edition</p>
      </div>
      <nav className="p-4">
        {navItems.map(item => (
          <button
            key={item.id}
            className={`nav-button ${activeTab === item.id ? 'active' : ''}`}
            onClick={() => {
              setActiveTab(item.id);
              if (window.innerWidth < 768) {
                handleMenuToggle();
              }
            }}
          >
            <item.icon size={20} />
            <span>{item.label}</span>
          </button>
        ))}
      </nav>
    </aside>
  );
};

const AIPanel = ({ onGenerate, generating, apiConfig }) => {
  const [prompt, setPrompt] = useState('');
  const [customPrompt, setCustomPrompt] = useState('');

  const quickPrompts = [
    "Generate 3 SMART objectives for a new product launch",
    "Create a SWOT analysis for a retail business",
    "Outline key initiatives for digital transformation",
    "Draft a mission statement for a sustainability startup"
  ];

  return (
    <div className="card p-6 mb-6">
      <div className="flex items-center justify-between mb-4">
        <div className="flex items-center gap-2">
          <Icons.Sparkles size={20} className="text-purple-500" />
          <h3 className="font-semibold text-lg">AI Assistant</h3>
        </div>
        <span className="ai-badge">Claude AI</span>
      </div>
      
      <div className="space-y-4">
        <div>
          <label className="block text-sm font-medium mb-2">Quick Prompts</label>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
            {quickPrompts.map((qp, index) => (
              <button
                key={index}
                className="text-left p-3 bg-slate-50 hover:bg-blue-50 rounded-lg text-sm border border-slate-200 transition-colors"
                onClick={() => onGenerate(qp, apiConfig)}
                disabled={generating}
              >
                {qp}
              </button>
            ))}
          </div>
        </div>
        
        <div>
          <label className="block text-sm font-medium mb-2">Custom Prompt</label>
          <textarea
            value={customPrompt}
            onChange={(e) => setCustomPrompt(e.target.value)}
            className="input-field w-full h-24 resize-vertical"
            placeholder="Enter your custom prompt for AI assistance..."
            disabled={generating}
          />
          <div className="flex gap-2 mt-2">
            <button
              className="btn-primary flex-1"
              onClick={() => onGenerate(customPrompt, apiConfig)}
              disabled={!customPrompt.trim() || generating}
            >
              {generating ? (
                <>
                  <Icons.Loader size={16} className="animate-spin mr-2" />
                  Generating...
                </>
              ) : 'Generate with AI'}
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};

const Dashboard = ({ aiContent, onGenerate, generating, apiConfig }) => {
  return (
    <div className="p-6">
      <div className="mb-8">
        <h2 className="text-2xl font-bold mb-2">Strategic Dashboard</h2>
        <p className="text-slate-600">Overview of your strategic planning progress</p>
      </div>

      <AIPanel onGenerate={onGenerate} generating={generating} apiConfig={apiConfig} />

      {aiContent && (
        <div className="card p-6 mb-6">
          <div className="flex items-center justify-between mb-4">
            <h3 className="font-semibold text-lg">AI Generated Content</h3>
            <button
              className="text-sm text-blue-600 hover:text-blue-700 font-medium"
              onClick={() => onGenerate("Refine and expand this content further", apiConfig)}
              disabled={generating}
            >
              Refine
            </button>
          </div>
          <div className="prose max-w-none">
            <div dangerouslySetInnerHTML={{ __html: aiContent.replace(/\n/g, '<br/>') }} />
          </div>
        </div>
      )}

      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div className="stat-card">
          <div>
            <p className="text-slate-500 text-sm">Objectives</p>
            <p className="text-2xl font-bold">12</p>
          </div>
          <Icons.Target size={24} className="text-blue-500" />
        </div>
        <div className="stat-card">
          <div>
            <p className="text-slate-500 text-sm">Initiatives</p>
            <p className="text-2xl font-bold">24</p>
          </div>
          <Icons.ClipboardList size={24} className="text-emerald-500" />
        </div>
        <div className="stat-card">
          <div>
            <p className="text-slate-500 text-sm">Team Members</p>
            <p className="text-2xl font-bold">8</p>
          </div>
          <Icons.Users size={24} className="text-purple-500" />
        </div>
        <div className="stat-card">
          <div>
            <p className="text-slate-500 text-sm">Completion</p>
            <p className="text-2xl font-bold">68%</p>
          </div>
          <Icons.PieChart size={24} className="text-orange-500" />
        </div>
      </div>
    </div>
  );
};

const SettingsModal = ({ isOpen, onClose, apiConfig, setApiConfig }) => {
  const [tempApiKey, setTempApiKey] = useState(apiConfig.apiKey);

  useEffect(() => {
    setTempApiKey(apiConfig.apiKey);
  }, [apiConfig.apiKey, isOpen]);

  const handleSubmit = (e) => {
    e.preventDefault();
    setApiConfig(prev => ({ ...prev, apiKey: tempApiKey }));
    onClose();
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-100 p-4">
      <div className="bg-white rounded-xl max-w-md w-full p-6">
        <div className="flex items-center justify-between mb-4">
          <h3 className="text-lg font-semibold">AI Settings</h3>
          <button onClick={onClose} className="p-1 hover:bg-slate-100 rounded">
            <Icons.X size={20} />
          </button>
        </div>
        
        <form onSubmit={handleSubmit}>
          <div className="mb-4">
            <label className="block text-sm font-medium mb-2">Claude API Key</label>
            <input
              type="password"
              value={tempApiKey}
              onChange={(e) => setTempApiKey(e.target.value)}
              className="input-field"
              placeholder="Enter your Claude API key"
            />
            <p className="text-xs text-slate-500 mt-1">
              Get your API key from{' '}
              <a href="https://console.anthropic.com/" target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:text-blue-700">
                Anthropic Console
              </a>
            </p>
          </div>
          
          <div className="flex gap-3">
            <button
              type="submit"
              className="btn-primary flex-1"
              disabled={!tempApiKey.trim()}
            >
              Save
            </button>
            <button
              type="button"
              onClick={onClose}
              className="px-4 py-2 border border-slate-300 rounded-lg hover:bg-slate-50"
            >
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

const App = () => {
  const [activeTab, setActiveTab] = useState('dashboard');
  const [isSidebarOpen, setIsSidebarOpen] = useState(false);
  const [aiContent, setAiContent] = useState('');
  const [generating, setGenerating] = useState(false);
  const [showSettings, setShowSettings] = useState(false);
  const [apiConfig, setApiConfig] = useState({
    apiKey: localStorage.getItem('claudeApiKey') || '',
    model: 'claude-3-5-sonnet-20241022',
    maxTokens: 1024,
    temperature: 0.7
  });

  // Save API key to localStorage when it changes
  useEffect(() => {
    if (apiConfig.apiKey) {
      localStorage.setItem('claudeApiKey', apiConfig.apiKey);
    }
  }, [apiConfig.apiKey]);

  const handleMenuToggle = () => {
    setIsSidebarOpen(!isSidebarOpen);
  };

  const handleGenerate = async (prompt, config) => {
    if (!config.apiKey) {
      setShowSettings(true);
      return;
    }

    if (!prompt.trim()) return;

    setGenerating(true);
    setAiContent('');

    try {
      const response = await ClaudeAIService.sendMessage(prompt, config.apiKey, {
        model: config.model,
        maxTokens: config.maxTokens,
        temperature: config.temperature
      });
      setAiContent(response);
    } catch (error) {
      setAiContent(`Error: ${error.message}`);
      console.error('AI Generation Error:', error);
    } finally {
      setGenerating(false);
    }
  };

  const renderContent = () => {
    switch (activeTab) {
      case 'dashboard':
        return <Dashboard 
          aiContent={aiContent} 
          onGenerate={handleGenerate} 
          generating={generating}
          apiConfig={apiConfig}
        />;
      default:
        return <Dashboard 
          aiContent={aiContent} 
          onGenerate={handleGenerate} 
          generating={generating}
          apiConfig={apiConfig}
        />;
    }
  };

  return (
    <div className="app-layout">
      <Sidebar 
        activeTab={activeTab} 
        setActiveTab={setActiveTab}
        handleMenuToggle={handleMenuToggle}
        isSidebarOpen={isSidebarOpen}
      />
      
      <main className="main-content" id="main-content">
        <header className="bg-white border-b border-slate-200 p-4 flex items-center justify-between">
          <button 
            className="md:hidden p-2 hover:bg-slate-100 rounded-lg"
            onClick={handleMenuToggle}
          >
            <Icons.Menu size={20} />
          </button>
          
          <div className="flex items-center gap-3">
            <button
              className="flex items-center gap-2 px-3 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-sm font-medium transition-colors"
              onClick={() => setShowSettings(true)}
            >
              <Icons.Sparkles size={16} className="text-purple-500" />
              AI Settings
            </button>
          </div>
        </header>
        
        {renderContent()}
      </main>

      <SettingsModal
        isOpen={showSettings}
        onClose={() => setShowSettings(false)}
        apiConfig={apiConfig}
        setApiConfig={setApiConfig}
      />
    </div>
  );
};

// Render the app
const root = document.getElementById('root');
ReactDOM.render(<App />, root);
</script>
</body>
</html>
